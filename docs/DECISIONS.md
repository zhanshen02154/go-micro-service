# 微服务架构演进实践决策记录

## 决策记录：运行环境服务器配置 
### 日期
2025年10月22日
### 状态
已采纳
### 背景
Apisix、Apisix Ingress Controller及K8S底层组件、Docker需要消耗部分内存，2核 CPU和2GB内存可能不足以应对额外部署的两个服务。
### 考虑方案
### 方案A：细化服务器资源分配，降低2个服务的CPU和内存使用量。
### 优点：
- 无需升级服务器，不会导致成本上升。
### 缺点：
- Pod资源极度紧张，底层组件和服务可能崩溃。
- 压测时Golang服务无法发挥多核CPU的优势，代码层面优化空间极为有限，压测已无意义。
### 方案B：升级2台运行环境服务器配置为4核8GB
### 优点：
- Pod资源明显增多，可以做压测，底层组件崩溃概率降低。
### 缺点：
- 服务器耗费的成本上升。
### 决策结果
采用方案B：升级2台运行环境服务器配置为4核8GB
### 理由：
- 虽然成本上升，但可以保证服务器资源不紧张，为后续的压测做好准备。
- 留出足够的空间给Apisix和底层组件。
### 后果：
- 复杂调用链路仍可能出现资源紧张问题

---

## 决策记录：Apisix内置ETCD问题
### 日期
2025年10月22日
### 状态
已采纳
### 背景
用helm安装Apisix内置一个ETCD组件，该组件随Apisix一同部署到K8S集群，安装后ETCD一直卡在申请PVC，其他服务也无法启动。
### 考虑方案
### 方案A：使用NFS挂载，深入研究PV/PVC再做配置
### 优点：
- 使用内置ETCD，无需编写Values配置文件。
### 缺点：
- ETCD伴随Apisix部署在K8S集群增加了运行环境的压力，不符合生产环境要求。
- NFS挂载操作步骤较多。
### 方案B：使用外部ETCD
### 优点：
- ETCD独立部署，无需考虑PV/PVC的问题。
### 缺点：
- 基础设施服务器压力增加
### 决策结果
使用外部ETCD。
### 理由：
- 独立部署ETCD符合生产环境要求，后续若时间充足可考虑复用已有资源将服务注册/发现从Consul迁移到ETCD。
- 留出足够的空间给Apisix和底层组件。
### 后果：
- 基础设施服务器压力增加，目前基础设施服务器安装了Jenkins、MySQL、Harbor、Redis、Docker、Consul但配置仅为2核 CPU加4GB内存。
- 压测过程中可能需要暂时关闭jenkins。
